<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="../globalStyles/body.css">
    <link rel="stylesheet" href="../globalStyles/poly1-div.css">
    <link rel="stylesheet" href="../globalStyles/log-n-sign.css">
</head>
<body>
    <img src="../assets/samplebg.jpg" class="bg-image-landscape" 
        style="
        ">

    <div class="outerContainer">

        <div class="left-container">
            <div class="logo">
                <img src="../assets/capstone-logo.png" alt="Code-Tropa Logo">
            </div>
        </div>

        <div class="right-container">
            <div class="login-container">
                <div class="backblur"></div>
                <div class="poly1">
                    <img src="../assets/poly1.png">
                    <p>LOGIN</p>
                </div>
                
                <form action="../auth.php" method="post">
                    <div class="input-group">
                        <input type="text" name="username" id="username" placeholder="" required>
                        <label for="username">Username</label>
                    </div>
                    <div class="input-group">
                        <input type="password" name="pass1" id="password" placeholder="" required>
                        <label for="password">Password</label>
                        <span class="show-password-toggle" id="toggle-password">üëÅÔ∏è</span>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" name="submit" value="log" class="login-btn" id="login-play-btn">
                            <!-- <img src="../assets/poly-button-black.png"> -->
                            <p>Play</p>
                        </button>

                        <button type="button" name="submit" value="" class="signup-btn">
                            <!-- <img src="../assets/poly-button-brown.png"> -->
                            <p>Sign Up</p>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    

    
    <script type="module">
        import { generateKeys } from '../homepage/scripts/keyGenerator.js';
        import { encrypt } from '../homepage/scripts/encryptor.js';

        document.getElementById('login-play-btn').addEventListener('click', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const usernameField = document.getElementById('username');
            const passwordField = document.getElementById('password');

            const username = usernameField.value;
            const password = passwordField.value;

            if (username && password) {
                const usernameKeys = generateKeys();
                const passwordKeys = generateKeys(); // Generate a separate key for password if needed, or use the same as username

                const usernameHash = encrypt(username, usernameKeys);
                const passwordHash = encrypt(password, passwordKeys);

                // Redirect to mid.html with hashed values and keys
                window.location.href = `../../2be/mid.html?u=${encodeURIComponent(usernameHash)}&uk=${encodeURIComponent(JSON.stringify(usernameKeys))}&p=${encodeURIComponent(passwordHash)}&pk=${encodeURIComponent(JSON.stringify(passwordKeys))}`;
            } else {
                alert('Please enter both username and password.');
            }
        });

        document.querySelector('.signup-btn').addEventListener('click', function() {
            window.location.href = '../signup/';
        });

        function togglePasswordVisibility() {
            const passwordField = document.getElementById('password');
            const toggleIcon = document.getElementById('toggle-password');
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.textContent = 'üîí'; // Change icon to a locked padlock
            } else {
                passwordField.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è'; // Change icon back to an eye
            }
        }

        document.getElementById('toggle-password').addEventListener('click', togglePasswordVisibility);

        // Clear localStorage on login page load
        localStorage.removeItem('encryptedUserData');
        localStorage.removeItem('encryptionKeys');

    </script>
</body>
</html>
