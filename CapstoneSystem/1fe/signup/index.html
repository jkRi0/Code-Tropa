<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup Page</title>
    <link rel="stylesheet" href="../globalStyles/body.css">
    <link rel="stylesheet" href="../globalStyles/poly1-div.css">
    <link rel="stylesheet" href="../globalStyles/log-n-sign.css">
</head>
<body>
    <img src="../assets/samplebg.jpg" class="bg-image-landscape" 
        style="
        ">

    <div class="outerContainer">

        <div class="left-container">
            <div class="logo">
                <img src="../assets/capstone-logo.png" alt="Code-Tropa Logo">
            </div>
        </div>

        <div class="right-container">
            <div class="signup-container">
                <div class="backblur"></div>
                <div class="poly1">
                    <img src="../assets/poly1.png">
                    <p>SIGN UP</p>
                </div>

                <form action="../auth.php" method="post">
                    <div class="input-group">
                        <input type="text"  name="username" placeholder="" required>
                        <label>Username</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="password" name="pass1" placeholder="" required>
                        <label for="password">Password</label>
                        <span class="show-password-toggle" onclick="togglePasswordVisibility('password')">üëÅÔ∏è</span>
                    </div>
                    <div class="input-group">
                        <input type="password" id="confirm-password" name="pass2" placeholder="" required>
                        <label for="confirm-password">Confirm Password</label>
                        <span class="show-password-toggle" onclick="togglePasswordVisibility('confirm-password')">üëÅÔ∏è</span>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" name="submit" value="signup" class="create-btn">
                            <!-- <img src="../assets/poly-button-black.png"> -->
                            <p>Create Account</p>
                        </button>

                        <button type="submit" name="submit" value="" class="cancel-btn">
                            <!-- <img src="../assets/poly-button-brown.png"> -->
                            <p>Cancel</p>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div> 
    
    <script type="module">
        import { generateKeys } from '../homepage/scripts/keyGenerator.js';
        import { encrypt } from '../homepage/scripts/encryptor.js';

        document.querySelector('.cancel-btn').addEventListener('click', function() {
            window.location.href = '../login/'; 
        });

        document.querySelector('.create-btn').addEventListener('click', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const usernameField = document.querySelector('input[name="username"]');
            const passwordField = document.getElementById('password');
            const confirmPasswordField = document.getElementById('confirm-password');

            const username = usernameField.value;
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;

            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }

            if (username && password) {
                const passwordKeys = generateKeys(); // Generate the 5-integer key
                const encryptedPassword = encrypt(password, passwordKeys); // Encrypt using the generated keys

                // Create a new form element to submit the data
                const form = document.createElement('form');
                form.method = 'post';
                form.action = '../auth.php';

                // Add hidden fields for username, encrypted password, password keys, and action type
                const usernameInput = document.createElement('input');
                usernameInput.type = 'hidden';
                usernameInput.name = 'hid1'; // Corresponds to username in auth.php
                usernameInput.value = username;
                form.appendChild(usernameInput);

                const passwordInput = document.createElement('input');
                passwordInput.type = 'hidden';
                passwordInput.name = 'hid2'; // Corresponds to password in auth.php
                passwordInput.value = encryptedPassword;
                form.appendChild(passwordInput);

                const confirmPasswordInput = document.createElement('input');
                confirmPasswordInput.type = 'hidden';
                confirmPasswordInput.name = 'hid3'; // Corresponds to confirm password in auth.php (for server-side validation)
                confirmPasswordInput.value = encryptedPassword; // Send encrypted password for comparison
                form.appendChild(confirmPasswordInput);

                const passwordKeysInput = document.createElement('input');
                passwordKeysInput.type = 'hidden';
                passwordKeysInput.name = 'passwordKeys';
                passwordKeysInput.value = JSON.stringify(passwordKeys);
                form.appendChild(passwordKeysInput);

                const actionTypeInput = document.createElement('input');
                actionTypeInput.type = 'hidden';
                actionTypeInput.name = 'actionType';
                actionTypeInput.value = 'signup';
                form.appendChild(actionTypeInput);

                document.body.appendChild(form); // Append the form to the document
                form.submit(); // Submit the form

            } else {
                alert('Please enter both username and password.');
            }
        });

        function togglePasswordVisibility(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleIcon = passwordField.nextElementSibling.nextElementSibling; // Assuming the span is after label
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.textContent = 'üîí'; // Change icon to a locked padlock
            } else {
                passwordField.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è'; // Change icon back to an eye
            }
        }


    </script>
</body>
</html>
