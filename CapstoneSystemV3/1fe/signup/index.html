<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup Page</title>
    <link rel="stylesheet" href="../globalStyles/body.css">
    <link rel="stylesheet" href="../globalStyles/poly1-div.css">
    <link rel="stylesheet" href="../globalStyles/log-n-sign.css">
</head>
<body>
    <img src="../assets/bg.png" class="bg-image-landscape" style="filter: blur(3px) brightness(0.3);">

    <div class="outerContainer">

        <div class="left-container">
            <div class="logo">
                <img src="../assets/capstone-logo.png" alt="Code-Tropa Logo">
            </div>
        </div>

        <div class="right-container">
            <div class="signup-container">
                <div class="backblur"></div>
                <div class="poly1">
                    <img src="../assets/poly1.png">
                    <p>SIGN UP</p>
                </div>

                <form action="" method="post">
                    <div class="input-group">
                        <input type="text"  name="username" placeholder="" required>
                        <label>Username</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="password" name="pass1" placeholder="" required>
                        <label for="password">Password</label>
                        <span class="show-password-toggle" onclick="togglePasswordVisibility('password')">üëÅÔ∏è</span>
                    </div>
                    <div class="input-group">
                        <input type="password" id="confirm-password" name="pass2" placeholder="" required>
                        <label for="confirm-password">Confirm Password</label>
                        <span class="show-password-toggle" onclick="togglePasswordVisibility('confirm-password')">üëÅÔ∏è</span>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" name="submit" value="signup" class="create-btn">
                            <!-- <img src="../assets/poly-button-black.png"> -->
                            <p>Create Account</p>
                        </button>

                        <button type="button" name="submit" value="" class="cancel-btn">
                            <!-- <img src="../assets/poly-button-brown.png"> -->
                            <p>Cancel</p>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div> 
    
    <script type="module">
        

        function validatePassword(password, username) {
            // Disallow leading or trailing spaces
            if (password !== password.trim()) {
                return { ok: false, message: 'Password cannot start or end with a blank space.' };
            }

            // Minimum length
            if (password.length < 8) {
                return { ok: false, message: 'Password must be at least 8 characters long.' };
            }

            // Character variety
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            const hasSpecial = /[^A-Za-z0-9]/.test(password);

            if (!hasUppercase || !hasLowercase || !hasNumber || !hasSpecial) {
                return { ok: false, message: 'Password must include uppercase, lowercase, number, and special character.' };
            }

            // Block common/weak passwords
            const weakList = new Set([
                'password', 'password1', 'password123', 'passw0rd', 'admin', 'administrator',
                'letmein', 'qwerty', 'qwerty123', 'abc123', 'iloveyou', 'welcome', 'monkey',
                'dragon', 'football', 'baseball', '111111', '123456', '1234567', '12345678',
                '123456789', '1234567890', '000000', 'sunshine'
            ]);
            const lower = password.toLowerCase();
            if (weakList.has(lower) || /password/.test(lower)) {
                return { ok: false, message: 'Password is too common or easily guessable.' };
            }

            // Basic username resemblance check (optional, strengthens policy)
            if (username && lower.includes(String(username).toLowerCase())) {
                return { ok: false, message: 'Password should not contain your username.' };
            }

            return { ok: true };
        }

        document.querySelector('.cancel-btn').addEventListener('click', function() {
            window.location.href = '../login/'; 
        });

        document.querySelector('.create-btn').addEventListener('click', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const usernameField = document.querySelector('input[name="username"]');
            const passwordField = document.getElementById('password');
            const confirmPasswordField = document.getElementById('confirm-password');

            const username = usernameField.value;
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;

            // Validate password against policy
            const validation = validatePassword(password, username);
            if (!validation.ok) {
                alert(validation.message);
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }

            if (username && password) {
                if(password===confirmPassword){
                    // Create a new form element to submit the data
                    const form = document.createElement('form');
                    form.method = 'post';
                    form.action = '../../2be/signup.php';

                    // Add hidden fields for username, encrypted password, password keys, and action type
                    const usernameInput = document.createElement('input');
                    usernameInput.type = 'hidden';
                    usernameInput.name = 'hid1'; // Corresponds to username in auth.php
                    usernameInput.value = username;
                    form.appendChild(usernameInput);

                    const passwordInput = document.createElement('input');
                    passwordInput.type = 'hidden';
                    passwordInput.name = 'hid2'; // Corresponds to password in auth.php
                    passwordInput.value = password;
                    form.appendChild(passwordInput);

                    
                    document.body.appendChild(form); // Append the form to the document
                    form.submit(); // Submit the form
                }else{
                    alert('Passwords do not match');
                }
                

            } else {
                alert('Please enter both username and password.');
            }
        });

    </script>

    <script>
        function togglePasswordVisibility(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleIcon = passwordField.nextElementSibling.nextElementSibling; // Assuming the span is after label
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleIcon.textContent = 'üîí'; // Change icon to a locked padlock
            } else {
                passwordField.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è'; // Change icon back to an eye
            }
        }
    </script>
</body>
</html>
